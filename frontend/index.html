<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSmart Jorethang - Eco Intelligent Agriculture</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-green: #4ade80;
            --secondary-green: #22c55e;
            --dark-green: #16a34a;
            --light-green: #dcfce7;
            --eco-gradient: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 50%, #34d399 100%);
            --sensor-bg: rgba(167, 243, 208, 0.15);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --text-dark: #064e3b;
            --text-light: #6b7280;
            --shadow-soft: 0 4px 20px rgba(34, 197, 94, 0.1);
            --shadow-strong: 0 8px 30px rgba(34, 197, 94, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, #d1fae5 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Floating Background Elements */
        .bg-decoration {
            position: fixed;
            opacity: 0.05;
            pointer-events: none;
            z-index: 0;
        }

        .leaf-1 { top: 10%; left: 5%; font-size: 8rem; color: var(--primary-green); transform: rotate(-15deg); }
        .leaf-2 { top: 60%; right: 8%; font-size: 6rem; color: var(--secondary-green); transform: rotate(25deg); }
        .leaf-3 { bottom: 20%; left: 12%; font-size: 10rem; color: var(--dark-green); transform: rotate(45deg); }

        /* Header Section */
        .header-section {
            position: relative;
            z-index: 10;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167, 243, 208, 0.3);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .brand-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .brand-logo {
            width: 70px;
            height: 70px;
            background: var(--eco-gradient);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
            box-shadow: var(--shadow-strong);
        }

        .brand-info h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--eco-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .brand-info p {
            color: var(--text-light);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .connection-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 18px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 12px;
            font-weight: 600;
            color: #dc2626;
        }

        .connection-indicator.connected {
            background: #f0fdf4;
            border-color: #bbf7d0;
            color: var(--dark-green);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc2626;
        }

        .status-dot.connected {
            background: var(--primary-green);
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            background: var(--sensor-bg);
            border-radius: 16px;
            padding: 6px;
            border: 2px solid rgba(34, 197, 94, 0.2);
        }

        .mode-btn {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            color: var(--text-light);
        }

        .mode-btn.active {
            background: var(--eco-gradient);
            color: white;
            box-shadow: var(--shadow-soft);
            transform: translateY(-1px);
        }

        /* Language Selector */
        .language-selector {
            position: relative;
        }

        .language-btn {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            border: 2px solid rgba(34, 197, 94, 0.2);
            background: var(--sensor-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .language-btn:hover {
            background: var(--primary-green);
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            box-shadow: var(--shadow-strong);
            z-index: 1000;
            min-width: 150px;
            display: none;
            overflow: hidden;
        }

        .language-dropdown.visible {
            display: block;
            animation: dropdownFade 0.2s ease;
        }

        .language-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .language-option:hover {
            background: var(--light-green);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Sensor Dashboard */
        .sensor-dashboard {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167, 243, 208, 0.3);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-soft);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            color: var(--primary-green);
        }

        .sensors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .sensor-card {
            background: var(--sensor-bg);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sensor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--eco-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sensor-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-strong);
        }

        .sensor-card:hover::before {
            opacity: 1;
        }

        .sensor-icon {
            font-size: 2.5rem;
            color: var(--primary-green);
            margin-bottom: 12px;
        }

        .sensor-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .sensor-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .sensor-unit {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .last-update {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* System Info Sidebar */
        .system-info {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .info-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167, 243, 208, 0.3);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-soft);
        }

        .info-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            color: var(--text-light);
            font-weight: 500;
        }

        .info-item i {
            color: var(--primary-green);
            width: 16px;
        }

        /* Control Sections */
        .control-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167, 243, 208, 0.3);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-soft);
            margin-bottom: 30px;
        }

        /* Automatic Mode Display */
        .auto-mode-display {
            text-align: center;
            padding: 40px;
        }

        .auto-icon {
            font-size: 4rem;
            color: var(--primary-green);
            margin-bottom: 20px;
        }

        .auto-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .auto-description {
            color: var(--text-light);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .ai-status-card {
            background: var(--sensor-bg);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
        }

        .ai-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            color: var(--dark-green);
            margin-bottom: 10px;
        }

        .ai-recommendation {
            color: var(--text-light);
            font-style: italic;
        }

        /* Manual Controls */
        .manual-section {
            display: none;
        }

        .control-tabs {
            display: flex;
            margin-bottom: 25px;
            background: var(--sensor-bg);
            border-radius: 12px;
            padding: 6px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: white;
            color: var(--text-dark);
            box-shadow: var(--shadow-soft);
        }

        .control-content {
            display: none;
        }

        .control-content.active {
            display: block;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .control-btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--eco-gradient);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-strong);
        }

        .btn-secondary {
            background: var(--sensor-bg);
            color: var(--text-dark);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .btn-danger {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.1);
        }

        /* Chat & Weather */
        .bottom-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .chat-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167, 243, 208, 0.3);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            height: 400px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(34, 197, 94, 0.1);
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
        }

        .user-message {
            background: var(--eco-gradient);
            color: white;
            margin-left: auto;
        }

        .bot-message {
            background: var(--light-green);
            color: var(--text-dark);
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            font-size: 1rem;
        }

        .weather-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167, 243, 208, 0.3);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-soft);
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .weather-day {
            background: var(--sensor-bg);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .weather-emoji {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .weather-temp {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .weather-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Animations */
        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .bottom-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .sensors-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .control-grid {
                grid-template-columns: 1fr;
            }

            .brand-info h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .sensors-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Status indicators */
        .status-success { color: var(--primary-green); }
        .status-warning { color: #f59e0b; }
        .status-error { color: #dc2626; }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Floating Background Decorations -->
    <div class="bg-decoration leaf-1">üåø</div>
    <div class="bg-decoration leaf-2">üçÉ</div>
    <div class="bg-decoration leaf-3">üå±</div>

    <div class="container">
        <!-- Header Section -->
        <header class="header-section">
            <div class="header-content">
                <div class="brand-section">
                    <div class="brand-logo">AS</div>
                    <div class="brand-info">
                        <h1 id="main-title">AgroSmart Jorethang</h1>
                        <p id="subtitle">AI Smart Irrigation with Rain Management</p>
                    </div>
                </div>

                <div class="header-controls">
                    <div class="connection-indicator" id="connection-status">
                        <div class="status-dot"></div>
                        <span id="connection-text">Connection error - retrying</span>
                    </div>

                    <div class="mode-toggle">
                        <button class="mode-btn" onclick="setMode('manual')" id="manual-btn">Manual</button>
                        <button class="mode-btn active" onclick="setMode('automatic')" id="auto-btn">Automatic</button>
                    </div>

                    <div class="language-selector">
                        <button class="language-btn" onclick="toggleLanguageDropdown()">üåê</button>
                        <div class="language-dropdown" id="languageDropdown">
                            <div class="language-option" onclick="changeLanguage('en')">
                                <span>üá∫üá∏</span> English
                            </div>
                            <div class="language-option" onclick="changeLanguage('hi')">
                                <span>üáÆüá≥</span> ‡§π‡§ø‡§Ç‡§¶‡•Ä
                            </div>
                            <div class="language-option" onclick="changeLanguage('ne')">
                                <span>üá≥üáµ</span> ‡§®‡•á‡§™‡§æ‡§≤‡•Ä
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Layout -->
        <div class="main-layout">
            <!-- Sensor Dashboard -->
            <div class="sensor-dashboard">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="sensor-title">Live ESP32 Sensor Data</span>
                </h2>

                <div class="sensors-grid">
                    <div class="sensor-card">
                        <div class="sensor-icon">üå°Ô∏è</div>
                        <div class="sensor-label temp-label">Temperature</div>
                        <div class="sensor-value" id="temperature">--</div>
                        <div class="sensor-unit">¬∞C</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-icon">üíß</div>
                        <div class="sensor-label humid-label">Humidity</div>
                        <div class="sensor-value" id="humidity">--</div>
                        <div class="sensor-unit">%</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-icon">üå±</div>
                        <div class="sensor-label soil-label">Soil Moisture</div>
                        <div class="sensor-value" id="soil-moisture">--</div>
                        <div class="sensor-unit">%</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-icon">ü™£</div>
                        <div class="sensor-label water-label">Water Level</div>
                        <div class="sensor-value" id="water-level">--</div>
                        <div class="sensor-unit">L</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-icon">üåßÔ∏è</div>
                        <div class="sensor-label rain-label">Rain Sensor</div>
                        <div class="sensor-value" id="rain-status">--</div>
                        <div class="sensor-unit"></div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-icon">‚ö°</div>
                        <div class="sensor-label pump-label">Pump Status</div>
                        <div class="sensor-value" id="pump-status">--</div>
                        <div class="sensor-unit"></div>
                    </div>
                </div>

                <div class="last-update">
                    <i class="fas fa-clock"></i>
                    <span class="update-text">Last Updated:</span> <span id="last-updated">Never</span>
                </div>
            </div>

            <!-- System Info Sidebar -->
            <div class="system-info">
                <div class="info-card">
                    <h3 class="info-title">
                        <i class="fas fa-wifi"></i>
                        <span class="connection-title">ESP32 Connection</span>
                    </h3>
                    <div class="connection-details">
                        <div class="info-item">
                            <i class="fas fa-circle status-indicator-icon"></i>
                            <span id="connection-status-text">Disconnected</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-network-wired"></i>
                            <span>ESP32 IP: <span id="esp32-ip">--</span></span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-sync-alt"></i>
                            <span class="update-interval-text">Data updates every 2 seconds</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3 class="info-title">
                        <i class="fas fa-cog"></i>
                        <span class="system-info-title">System Information</span>
                    </h3>
                    <ul class="info-list">
                        <li class="info-item">
                            <i class="fas fa-check-circle"></i>
                            <span class="rain-mgmt-text">Rain management active</span>
                        </li>
                        <li class="info-item">
                            <i class="fas fa-play-circle"></i>
                            <span class="auto-pause-text">Auto pause/resume enabled</span>
                        </li>
                        <li class="info-item">
                            <i class="fas fa-brain"></i>
                            <span class="smart-decisions-text">Smart irrigation decisions</span>
                        </li>
                        <li class="info-item">
                            <i class="fas fa-language"></i>
                            <span class="multi-lang-text">Multi-language support</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Control Section -->
        <div class="control-section">
            <h2 class="section-title">
                <i class="fas fa-sliders-h"></i>
                <span class="control-title">System Control</span>
            </h2>

            <!-- Automatic Mode Display -->
            <div id="automatic-section" class="auto-mode-display">
                <div class="auto-icon pulse">ü§ñ</div>
                <h3 class="auto-title ai-title">AI Auto-Management Active</h3>
                <p class="auto-description ai-description">
                    System is monitoring sensors and will automatically irrigate when needed based on 
                    soil moisture, weather conditions, and crop requirements for optimal plant health.
                </p>

                <div class="ai-status-card">
                    <div class="ai-status">
                        <i class="fas fa-brain"></i>
                        <span>AI Status: <span class="status-success">Active & Learning</span></span>
                    </div>
                    <div class="ai-recommendation" id="ai-recommendation">
                        Analyzing sensor data and environmental conditions...
                    </div>
                </div>
            </div>

            <!-- Manual Mode Controls -->
            <div id="manual-section" class="manual-section">
                <div class="control-tabs">
                    <button class="tab-btn active" onclick="switchTab('immediate')" id="immediate-tab">
                        <i class="fas fa-bolt"></i> <span class="immediate-text">Immediate</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('scheduled')" id="scheduled-tab">
                        <i class="fas fa-calendar"></i> <span class="scheduled-text">Scheduled</span>
                    </button>
                </div>

                <!-- Immediate Control -->
                <div id="immediate-content" class="control-content active">
                    <div class="input-group">
                        <label for="duration" class="input-label duration-label">Duration (minutes):</label>
                        <input type="number" id="duration" class="input-field" min="1" max="120" value="10" placeholder="Enter minutes">
                    </div>

                    <div class="control-grid">
                        <button class="control-btn btn-primary" onclick="startImmediateIrrigation()">
                            <i class="fas fa-play"></i> <span class="start-text">Start Pump</span>
                        </button>
                        <button class="control-btn btn-secondary" onclick="pauseIrrigation()">
                            <i class="fas fa-pause"></i> <span class="pause-text">Pause</span>
                        </button>
                        <button class="control-btn btn-secondary" onclick="resumeIrrigation()">
                            <i class="fas fa-play"></i> <span class="resume-text">Resume</span>
                        </button>
                        <button class="control-btn btn-danger" onclick="stopIrrigation()">
                            <i class="fas fa-stop"></i> <span class="stop-text">Stop</span>
                        </button>
                    </div>

                    <div id="irrigation-status" class="ai-status-card" style="display: none;">
                        <div class="ai-status">
                            <i class="fas fa-info-circle"></i>
                            <span id="status-text">Ready</span>
                        </div>
                    </div>
                </div>

                <!-- Scheduled Control -->
                <div id="scheduled-content" class="control-content">
                    <div class="input-group">
                        <label class="input-label days-label">Select Days:</label>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="monday">
                                <span class="day-monday">Mon</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="tuesday">
                                <span class="day-tuesday">Tue</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="wednesday">
                                <span class="day-wednesday">Wed</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="thursday">
                                <span class="day-thursday">Thu</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="friday">
                                <span class="day-friday">Fri</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="saturday">
                                <span class="day-saturday">Sat</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="sunday">
                                <span class="day-sunday">Sun</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="days" value="all">
                                <span class="day-all">All Days</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="schedule-time" class="input-label time-label">Time:</label>
                        <input type="time" id="schedule-time" class="input-field" value="06:00">
                    </div>

                    <div class="input-group">
                        <label for="schedule-duration" class="input-label schedule-duration-label">Duration (minutes):</label>
                        <input type="number" id="schedule-duration" class="input-field" min="1" max="120" value="15">
                    </div>

                    <div style="text-align: center; margin-bottom: 25px;">
                        <button class="control-btn btn-primary" onclick="addSchedule()">
                            <i class="fas fa-plus"></i> <span class="add-schedule-text">Add Schedule</span>
                        </button>
                    </div>

                    <div class="ai-status-card" id="schedule-list">
                        <div class="ai-status">
                            <i class="fas fa-calendar-alt"></i>
                            <span class="no-schedules">No scheduled irrigation jobs</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Section: Chat & Weather -->
        <div class="bottom-section">
            <!-- AI Chat -->
            <div class="chat-container">
                <h2 class="section-title">
                    <i class="fas fa-comments"></i>
                    <span class="chat-title">AI Farming Assistant</span>
                </h2>

                <div class="chat-messages" id="chat-messages">
                    <div class="message bot-message">
                        <i class="fas fa-leaf" style="color: var(--primary-green); margin-right: 8px;"></i>
                        <span class="welcome-message">üåæ Namaste! I'm your Jorethang farming expert AI. Ask me about crops, irrigation, soil management, or weather patterns specific to our valley!</span>
                    </div>
                </div>

                <div class="chat-input-container">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Ask about farming in Jorethang...">
                    <button class="control-btn btn-primary" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i> <span class="send-text">Send</span>
                    </button>
                </div>
            </div>

            <!-- Weather Forecast -->
            <div class="weather-card">
                <h2 class="section-title">
                    <i class="fas fa-cloud-sun"></i>
                    <span class="weather-title">Weather Forecast</span>
                </h2>
                <p style="color: var(--text-light); margin-bottom: 20px; font-size: 0.9rem;">Jorethang Valley</p>

                <div class="weather-grid" id="weather-grid">
                    <div class="weather-day">
                        <div class="weather-emoji">‚è≥</div>
                        <div class="weather-temp loading-weather">Loading...</div>
                        <div class="weather-desc"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = 'en';
        let currentMode = 'automatic';
        let chatHistory = [];
        let irrigationStatus = 'stopped';
        let updateInterval;

        // Translations
        const translations = {
            en: {
                'main-title': 'AgroSmart Jorethang',
                'subtitle': 'AI Smart Irrigation with Rain Management',
                'sensor-title': 'Live ESP32 Sensor Data',
                'control-title': 'System Control',
                'chat-title': 'AI Farming Assistant',
                'weather-title': 'Weather Forecast',
                'connection-title': 'ESP32 Connection',
                'system-info-title': 'System Information',
                'temp-label': 'Temperature',
                'humid-label': 'Humidity',
                'soil-label': 'Soil Moisture',
                'water-label': 'Water Level',
                'rain-label': 'Rain Sensor',
                'pump-label': 'Pump Status',
                'update-text': 'Last Updated:',
                'update-interval-text': 'Data updates every 2 seconds',
                'rain-mgmt-text': 'Rain management active',
                'auto-pause-text': 'Auto pause/resume enabled',
                'smart-decisions-text': 'Smart irrigation decisions',
                'multi-lang-text': 'Multi-language support',
                'ai-title': 'AI Auto-Management Active',
                'ai-description': 'System is monitoring sensors and will automatically irrigate when needed based on soil moisture, weather conditions, and crop requirements for optimal plant health.',
                'immediate-text': 'Immediate',
                'scheduled-text': 'Scheduled',
                'duration-label': 'Duration (minutes):',
                'start-text': 'Start Pump',
                'pause-text': 'Pause',
                'resume-text': 'Resume',
                'stop-text': 'Stop',
                'days-label': 'Select Days:',
                'time-label': 'Time:',
                'schedule-duration-label': 'Duration (minutes):',
                'add-schedule-text': 'Add Schedule',
                'no-schedules': 'No scheduled irrigation jobs',
                'welcome-message': 'üåæ Namaste! I\'m your Jorethang farming expert AI. Ask me about crops, irrigation, soil management, or weather patterns specific to our valley!',
                'send-text': 'Send',
                'loading-weather': 'Loading...',
                'day-monday': 'Mon',
                'day-tuesday': 'Tue',
                'day-wednesday': 'Wed',
                'day-thursday': 'Thu',
                'day-friday': 'Fri',
                'day-saturday': 'Sat',
                'day-sunday': 'Sun',
                'day-all': 'All Days'
            },
            hi: {
                'main-title': '‡§è‡§ó‡•ç‡§∞‡•ã‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ú‡•ã‡§∞‡•á‡§•‡§æ‡§Ç‡§ó',
                'subtitle': '‡§µ‡§∞‡•ç‡§∑‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡•á ‡§∏‡§æ‡§• AI ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à',
                'sensor-title': '‡§≤‡§æ‡§á‡§µ ESP32 ‡§∏‡•á‡§Ç‡§∏‡§∞ ‡§°‡•á‡§ü‡§æ',
                'control-title': '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£',
                'chat-title': 'AI ‡§ï‡•É‡§∑‡§ø ‡§∏‡§π‡§æ‡§Ø‡§ï',
                'weather-title': '‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®',
                'connection-title': 'ESP32 ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§®',
                'system-info-title': '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä',
                'temp-label': '‡§§‡§æ‡§™‡§Æ‡§æ‡§®',
                'humid-label': '‡§®‡§Æ‡•Ä',
                'soil-label': '‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§®‡§Æ‡•Ä',
                'water-label': '‡§™‡§æ‡§®‡•Ä ‡§ï‡§æ ‡§∏‡•ç‡§§‡§∞',
                'rain-label': '‡§µ‡§∞‡•ç‡§∑‡§æ ‡§∏‡§Ç‡§µ‡•á‡§¶‡§ï',
                'pump-label': '‡§™‡§Ç‡§™ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                'update-text': '‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü:',
                'update-interval-text': '‡§π‡§∞ 2 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§°‡•á‡§ü‡§æ ‡§Ö‡§™‡§°‡•á‡§ü',
                'rain-mgmt-text': '‡§µ‡§∞‡•ç‡§∑‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø',
                'auto-pause-text': '‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•ã‡§ï‡§®‡§æ/‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ ‡§∏‡§ï‡•ç‡§∑‡§Æ',
                'smart-decisions-text': '‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø',
                'multi-lang-text': '‡§¨‡§π‡•Å-‡§≠‡§æ‡§∑‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§®',
                'ai-title': 'AI ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø',
                'ai-description': '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•á‡§Ç‡§∏‡§∞ ‡§ï‡•Ä ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§®‡§Æ‡•Ä, ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§î‡§∞ ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡§∞‡•á‡§ó‡§æ‡•§',
                'immediate-text': '‡§§‡§§‡•ç‡§ï‡§æ‡§≤',
                'scheduled-text': '‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§',
                'duration-label': '‡§Ö‡§µ‡§ß‡§ø (‡§Æ‡§ø‡§®‡§ü):',
                'start-text': '‡§™‡§Ç‡§™ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'pause-text': '‡§∞‡•ã‡§ï‡•á‡§Ç',
                'resume-text': '‡§´‡§ø‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'stop-text': '‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                'days-label': '‡§¶‡§ø‡§® ‡§ö‡•Å‡§®‡•á‡§Ç:',
                'time-label': '‡§∏‡§Æ‡§Ø:',
                'schedule-duration-label': '‡§Ö‡§µ‡§ß‡§ø (‡§Æ‡§ø‡§®‡§ü):',
                'add-schedule-text': '‡§∂‡•á‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
                'no-schedules': '‡§ï‡•ã‡§à ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç',
                'welcome-message': 'üåæ ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§ú‡•ã‡§∞‡•á‡§•‡§æ‡§Ç‡§ó ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û AI ‡§π‡•Ç‡§Ç‡•§ ‡§´‡§∏‡§≤, ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à, ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§Ø‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç!',
                'send-text': '‡§≠‡•á‡§ú‡•á‡§Ç',
                'loading-weather': '‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...',
                'day-monday': '‡§∏‡•ã‡§Æ',
                'day-tuesday': '‡§Æ‡§Ç‡§ó‡§≤',
                'day-wednesday': '‡§¨‡•Å‡§ß',
                'day-thursday': '‡§ó‡•Å‡§∞‡•Å',
                'day-friday': '‡§∂‡•Å‡§ï‡•ç‡§∞',
                'day-saturday': '‡§∂‡§®‡§ø',
                'day-sunday': '‡§∞‡§µ‡§ø',
                'day-all': '‡§∏‡§≠‡•Ä ‡§¶‡§ø‡§®'
            },
            ne: {
                'main-title': '‡§è‡§ó‡•ç‡§∞‡•ã‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ú‡•ã‡§∞‡•á‡§•‡§æ‡§Ç‡§ó',
                'subtitle': '‡§µ‡§∞‡•ç‡§∑‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® ‡§∏‡§Ç‡§ó AI ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à',
                'sensor-title': '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§ï‡•ç‡§∑ ESP32 ‡§∏‡•á‡§®‡•ç‡§∏‡§∞ ‡§°‡§æ‡§ü‡§æ',
                'control-title': '‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§®‡§ø‡§Ø‡§®‡•ç‡§§‡•ç‡§∞‡§£',
                'chat-title': 'AI ‡§ï‡•É‡§∑‡§ø ‡§∏‡§π‡§æ‡§Ø‡§ï',
                'weather-title': '‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®',
                'connection-title': 'ESP32 ‡§ú‡§°‡§æ‡§®',
                'system-info-title': '‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä',
                'temp-label': '‡§§‡§æ‡§™‡§ï‡•ç‡§∞‡§Æ',
                'humid-label': '‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ',
                'soil-label': '‡§Æ‡§æ‡§ü‡•ã‡§ï‡•ã ‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ',
                'water-label': '‡§™‡§æ‡§®‡•Ä‡§ï‡•ã ‡§∏‡•ç‡§§‡§∞',
                'rain-label': '‡§µ‡§∞‡•ç‡§∑‡§æ ‡§∏‡§Ç‡§µ‡•á‡§¶‡§ï',
                'pump-label': '‡§™‡§Æ‡•ç‡§™ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                'update-text': '‡§Ö‡§®‡•ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü:',
                'update-interval-text': '‡§π‡§∞‡•á‡§ï ‡•® ‡§∏‡•á‡§ï‡•á‡§®‡•ç‡§°‡§Æ‡§æ ‡§°‡§æ‡§ü‡§æ ‡§Ö‡§™‡§°‡•á‡§ü',
                'rain-mgmt-text': '‡§µ‡§∞‡•ç‡§∑‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø',
                'auto-pause-text': '‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•ã‡§ï‡•ç‡§®‡•á/‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•á ‡§∏‡§ï‡•ç‡§∑‡§Æ',
                'smart-decisions-text': '‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø‡§π‡§∞‡•Ç',
                'multi-lang-text': '‡§¨‡§π‡•Å-‡§≠‡§æ‡§∑‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§®',
                'ai-title': 'AI ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø',
                'ai-description': '‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä‡§≤‡•á ‡§∏‡•á‡§®‡•ç‡§∏‡§∞‡§π‡§∞‡•Ç‡§ï‡•ã ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ó‡§∞‡§ø‡§∞‡§π‡•á‡§ï‡•ã ‡§õ ‡§∞ ‡§Æ‡§æ‡§ü‡•ã‡§ï‡•ã ‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ, ‡§Æ‡•å‡§∏‡§Æ‡§ï‡•ã ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§∞ ‡§¨‡§æ‡§≤‡•Ä‡§ï‡•ã ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§ï‡§æ ‡§Ü‡§ß‡§æ‡§∞‡§Æ‡§æ ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™‡§Æ‡§æ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ó‡§∞‡•ç‡§®‡•á‡§õ‡•§',
                'immediate-text': '‡§§‡•Å‡§∞‡•Å‡§®‡•ç‡§§',
                'scheduled-text': '‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§',
                'duration-label': '‡§Ö‡§µ‡§ß‡§ø (‡§Æ‡§ø‡§®‡•á‡§ü):',
                'start-text': '‡§™‡§Æ‡•ç‡§™ ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                'pause-text': '‡§∞‡•ã‡§ï‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                'resume-text': '‡§´‡•á‡§∞‡§ø ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                'stop-text': '‡§¨‡§®‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                'days-label': '‡§¶‡§ø‡§®‡§π‡§∞‡•Ç ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç:',
                'time-label': '‡§∏‡§Æ‡§Ø:',
                'schedule-duration-label': '‡§Ö‡§µ‡§ß‡§ø (‡§Æ‡§ø‡§®‡•á‡§ü):',
                'add-schedule-text': '‡§§‡§æ‡§≤‡§ø‡§ï‡§æ ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                'no-schedules': '‡§ï‡•Å‡§®‡•à ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§π‡§∞‡•Ç ‡§õ‡•à‡§®‡§®‡•ç',
                'welcome-message': 'üåæ ‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞! ‡§Æ ‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§ú‡•ã‡§∞‡•á‡§•‡§æ‡§Ç‡§ó ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û AI ‡§π‡•Å‡§Å‡•§ ‡§¨‡§æ‡§≤‡•Ä, ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à, ‡§Æ‡§æ‡§ü‡•ã ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® ‡§µ‡§æ ‡§Æ‡•å‡§∏‡§Æ‡§ï‡•ã ‡§¨‡§æ‡§∞‡•á‡§Æ‡§æ ‡§∏‡•ã‡§ß‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!',
                'send-text': '‡§™‡§†‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                'loading-weather': '‡§≤‡•ã‡§° ‡§≠‡§á‡§∞‡§π‡•á‡§ï‡•ã ‡§õ...',
                'day-monday': '‡§∏‡•ã‡§Æ',
                'day-tuesday': '‡§Æ‡§ô‡•ç‡§ó‡§≤',
                'day-wednesday': '‡§¨‡•Å‡§ß',
                'day-thursday': '‡§¨‡§ø‡§π‡§ø',
                'day-friday': '‡§∂‡•Å‡§ï‡•ç‡§∞',
                'day-saturday': '‡§∂‡§®‡§ø',
                'day-sunday': '‡§Ü‡§á‡§§',
                'day-all': '‡§∏‡§¨‡•à ‡§¶‡§ø‡§®‡§π‡§∞‡•Ç'
            }
        };

        // FIXED: Mode toggle function
        function setMode(mode) {
            currentMode = mode;
            console.log('üîÑ Mode changed to:', mode);

            // Update backend
            fetch('http://localhost:5000/api/mode', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mode: mode })
            })
            .then(response => response.json())
            .then(data => {
                console.log('‚úÖ Mode updated on backend:', data);
                updateModeDisplay();
            })
            .catch(error => {
                console.error('‚ùå Error updating mode:', error);
                updateModeDisplay(); // Still update UI
            });
        }

        function updateModeDisplay() {
            const autoBtn = document.getElementById('auto-btn');
            const manualBtn = document.getElementById('manual-btn');
            const autoSection = document.getElementById('automatic-section');
            const manualSection = document.getElementById('manual-section');

            if (currentMode === 'automatic') {
                autoBtn.classList.add('active');
                manualBtn.classList.remove('active');
                autoSection.style.display = 'block';
                manualSection.style.display = 'none';
            } else {
                autoBtn.classList.remove('active');
                manualBtn.classList.add('active');
                autoSection.style.display = 'none';
                manualSection.style.display = 'block';
            }
        }

        // FIXED: Language functions
        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('languageDropdown');
            dropdown.classList.toggle('visible');

            if (dropdown.classList.contains('visible')) {
                document.addEventListener('click', function outsideClickListener(e) {
                    if (!e.target.closest('.language-selector')) {
                        dropdown.classList.remove('visible');
                        document.removeEventListener('click', outsideClickListener);
                    }
                });
            }
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            console.log('üåê Language changed to:', lang);

            const langData = translations[lang];
            if (langData) {
                Object.entries(langData).forEach(([key, value]) => {
                    // Update by ID
                    const elById = document.getElementById(key);
                    if (elById) elById.textContent = value;

                    // Update by class
                    const elsByClass = document.getElementsByClassName(key);
                    Array.from(elsByClass).forEach(el => {
                        el.textContent = value;
                    });
                });
            }

            document.getElementById('languageDropdown').classList.remove('visible');
        }

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');

            document.querySelectorAll('.control-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + '-content').classList.add('active');
        }

        // Initialize the system
        function init() {
            console.log('üå± AgroSmart Jorethang Eco v6.0 - Initializing...');
            loadWeatherData();
            startSensorUpdates();
            updateModeDisplay();

            document.getElementById('chat-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });

            console.log('‚úÖ System initialized successfully');
        }

        // Sensor updates
        function startSensorUpdates() {
            updateInterval = setInterval(updateSensorData, 2000);
            console.log('üîÑ Started sensor updates every 2 seconds');
        }

        function updateSensorData() {
            fetch('http://localhost:5000/api/sensors')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('temperature').textContent = data.temperature?.toFixed(1) || '--';
                    document.getElementById('humidity').textContent = data.humidity?.toFixed(1) || '--';
                    document.getElementById('soil-moisture').textContent = data.soil_moisture?.toFixed(1) || '--';
                    document.getElementById('water-level').textContent = Math.round(data.water_level || 0);
                    document.getElementById('rain-status').textContent = data.rain_detected ? 'Yes' : 'No';
                    document.getElementById('pump-status').textContent = data.pump_running ? 'ON' : 'OFF';
                    document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();

                    const connectionStatus = document.getElementById('connection-status');
                    const statusDot = connectionStatus.querySelector('.status-dot');
                    const connectionText = document.getElementById('connection-text');
                    const esp32Ip = document.getElementById('esp32-ip');
                    const statusIcon = document.querySelector('.status-indicator-icon');
                    const statusText = document.getElementById('connection-status-text');

                    if (data.esp32_connected) {
                        connectionStatus.classList.add('connected');
                        statusDot.classList.add('connected');
                        connectionText.textContent = 'Connected to ESP32';
                        esp32Ip.textContent = data.esp32_ip || 'Unknown';
                        if (statusIcon) statusIcon.className = 'fas fa-circle status-success';
                        if (statusText) statusText.textContent = 'Connected';
                    } else {
                        connectionStatus.classList.remove('connected');
                        statusDot.classList.remove('connected');
                        connectionText.textContent = 'Connection error - retrying';
                        esp32Ip.textContent = '--';
                        if (statusIcon) statusIcon.className = 'fas fa-circle status-error';
                        if (statusText) statusText.textContent = 'Disconnected';
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error updating sensor data:', error);
                    document.getElementById('connection-text').textContent = 'Connection error - retrying';
                });
        }

        // Irrigation controls
        function startImmediateIrrigation() {
            const duration = parseInt(document.getElementById('duration').value);
            if (!duration || duration < 1 || duration > 120) {
                alert('Please enter a valid duration between 1 and 120 minutes');
                return;
            }

            fetch('http://localhost:5000/api/irrigation/immediate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'start', duration: duration })
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('irrigation-status');
                const statusText = document.getElementById('status-text');

                if (data.success) {
                    statusDiv.style.display = 'block';
                    statusDiv.className = 'ai-status-card fade-in';
                    statusText.innerHTML = `<span class="status-success">‚úÖ ${data.message}</span>`;
                    irrigationStatus = 'running';
                } else {
                    statusDiv.style.display = 'block';
                    statusText.innerHTML = `<span class="status-error">‚ùå ${data.error}</span>`;
                }
            })
            .catch(error => {
                console.error('‚ùå Error starting irrigation:', error);
                const statusDiv = document.getElementById('irrigation-status');
                const statusText = document.getElementById('status-text');
                statusDiv.style.display = 'block';
                statusText.innerHTML = '<span class="status-error">‚ùå Failed to connect to system</span>';
            });
        }

        function pauseIrrigation() { sendIrrigationCommand('pause'); }
        function resumeIrrigation() { sendIrrigationCommand('resume'); }
        function stopIrrigation() { sendIrrigationCommand('stop'); }

        function sendIrrigationCommand(action) {
            fetch('http://localhost:5000/api/irrigation/immediate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: action })
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('irrigation-status');
                const statusText = document.getElementById('status-text');

                if (data.success) {
                    statusDiv.style.display = 'block';
                    statusText.innerHTML = `<span class="status-success">‚úÖ ${data.message}</span>`;
                    irrigationStatus = action === 'stop' ? 'stopped' : action;
                } else {
                    statusDiv.style.display = 'block';
                    statusText.innerHTML = `<span class="status-error">‚ùå ${data.error}</span>`;
                }
            })
            .catch(error => {
                console.error(`‚ùå Error ${action} irrigation:`, error);
                document.getElementById('status-text').innerHTML = `<span class="status-error">‚ùå Failed to ${action} irrigation</span>`;
            });
        }

        // Schedule management
        function addSchedule() {
            const days = Array.from(document.querySelectorAll('input[name="days"]:checked')).map(cb => cb.value);
            const time = document.getElementById('schedule-time').value;
            const duration = parseInt(document.getElementById('schedule-duration').value);

            if (days.length === 0) {
                alert('Please select at least one day');
                return;
            }

            if (!time) {
                alert('Please select a time');
                return;
            }

            if (!duration || duration < 1 || duration > 120) {
                alert('Please enter a valid duration between 1 and 120 minutes');
                return;
            }

            fetch('http://localhost:5000/api/irrigation/schedule', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ days: days, time: time, duration: duration })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ Schedule added successfully!');
                    loadSchedules();
                    // Reset form
                    document.querySelectorAll('input[name="days"]').forEach(cb => cb.checked = false);
                    document.getElementById('schedule-time').value = '06:00';
                    document.getElementById('schedule-duration').value = '15';
                } else {
                    alert('‚ùå Failed to add schedule: ' + data.error);
                }
            })
            .catch(error => {
                console.error('‚ùå Error adding schedule:', error);
                alert('‚ùå Failed to add schedule. Please check your connection.');
            });
        }

        function loadSchedules() {
            fetch('http://localhost:5000/api/irrigation/schedule')
                .then(response => response.json())
                .then(data => {
                    const scheduleList = document.getElementById('schedule-list');

                    if (data.success && Object.keys(data.scheduled_jobs).length > 0) {
                        scheduleList.innerHTML = '';

                        for (const [jobId, job] of Object.entries(data.scheduled_jobs)) {
                            const scheduleDiv = document.createElement('div');
                            scheduleDiv.className = 'ai-status';
                            scheduleDiv.innerHTML = `
                                <div style="flex: 1;">
                                    <strong>${job.days.join(', ')} at ${job.time}</strong><br>
                                    <small>Duration: ${job.duration} min | Status: ${job.status}</small>
                                </div>
                                <button class="control-btn btn-danger" onclick="deleteSchedule('${jobId}')" style="padding: 6px 12px; font-size: 0.8rem;">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            `;
                            scheduleList.appendChild(scheduleDiv);
                        }
                    } else {
                        scheduleList.innerHTML = '<div class="ai-status"><i class="fas fa-calendar-alt"></i><span>No scheduled irrigation jobs</span></div>';
                    }
                })
                .catch(error => console.error('‚ùå Error loading schedules:', error));
        }

        function deleteSchedule(jobId) {
            if (confirm('Are you sure you want to delete this schedule?')) {
                fetch(`http://localhost:5000/api/irrigation/schedule?job_id=${jobId}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadSchedules();
                        } else {
                            alert('‚ùå Failed to delete schedule: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Error deleting schedule:', error);
                        alert('‚ùå Failed to delete schedule. Please check your connection.');
                    });
            }
        }

        // Chat functions
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();

            if (!message) return;

            addMessageToChat(message, 'user');
            input.value = '';

            const typingDiv = addMessageToChat('ü§ñ AI is analyzing your question...', 'bot');

            fetch('http://localhost:5000/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message, language: currentLanguage })
            })
            .then(response => response.json())
            .then(data => {
                typingDiv.remove();

                if (data.success) {
                    addMessageToChat(data.response, 'bot');
                } else {
                    addMessageToChat('Sorry, I\'m having trouble right now. Please try again later.', 'bot');
                }
            })
            .catch(error => {
                console.error('‚ùå Error sending chat message:', error);
                typingDiv.remove();
                addMessageToChat('Sorry, I can\'t connect to the AI service right now. Please check your connection.', 'bot');
            });
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message fade-in`;

            if (sender === 'bot') {
                messageDiv.innerHTML = `<i class="fas fa-leaf" style="color: var(--primary-green); margin-right: 8px;"></i>${message}`;
            } else {
                messageDiv.innerHTML = message;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            return messageDiv;
        }

        // FIXED: Weather functions
        function loadWeatherData() {
            fetch('http://localhost:5000/api/weather')
                .then(response => response.json())
                .then(data => {
                    const weatherGrid = document.getElementById('weather-grid');

                    if (data.daily_forecast && data.daily_forecast.length > 0) {
                        weatherGrid.innerHTML = '';

                        data.daily_forecast.slice(0, 4).forEach(day => {
                            const weatherDay = document.createElement('div');
                            weatherDay.className = 'weather-day fade-in';
                            weatherDay.innerHTML = `
                                <div class="weather-emoji">${day.condition_emoji}</div>
                                <div class="weather-temp">${day.temp_max}¬∞/${day.temp_min}¬∞C</div>
                                <div class="weather-desc">${day.date_formatted.split(',')[0]}<br>${day.condition}</div>
                            `;
                            weatherGrid.appendChild(weatherDay);
                        });
                    } else {
                        weatherGrid.innerHTML = '<div class="weather-day"><div class="weather-emoji">‚ùå</div><div class="weather-temp">No Data</div><div class="weather-desc">Failed to load</div></div>';
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading weather:', error);
                    document.getElementById('weather-grid').innerHTML = 
                        '<div class="weather-day"><div class="weather-emoji">‚ùå</div><div class="weather-temp">Error</div><div class="weather-desc">Connection failed</div></div>';
                });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM Content Loaded - Starting AgroSmart Jorethang Eco v6.0');
            init();
            loadSchedules();
        });

        // Cleanup
        window.addEventListener('beforeunload', function() {
            if (updateInterval) clearInterval(updateInterval);
        });
    </script>
</body>
</html>